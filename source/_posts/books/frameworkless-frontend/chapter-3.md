---
title: 3장. DOM 이벤트 관리
date: 2024-11-10 20:57:26
categories:
- Books
- 프레임워크 없는 프론트엔드
#tags:
---
## YAGNI 원칙

- "You aren't gonna need it"의 줄임말
- 익스트림 프로그래밍(Extreme Programming, XP) 원칙 중 하나
  - "당신이 필요하다고 예측할 때가 아니라 실제로 필요할 때 구현하라" by Ron Jeffries
- 먼저 가장 중요한 기능에 초점을 맞춰 개발하고 새로운 요구가 생기면 이에 따라 아키텍처를 지속적으로 발전시켜 나가는 방식을 추구합니다.
- 프레임워크가 없는 프로젝트에서는 절대적으로 중요합니다.
  - 아키텍처를 작성할 때 YAGNI 원칙에 따라 당시 직면한 문제만을 해결하도록 구현합니다.
  - 과도한 엔지니어링에 의해서 아무도 유지하거나 관리하지 않는 또 다른 프레임워크를 만들어서 비용이 발생합니다.

## DOM 이벤트 API

- 이벤트란?
  - 웹앱에서 사용자(마우스, 키보드, 뷰 등) 또는 시스템(네트워크 상태의 변화, DOM 콘텐츠 로딩 등)에 의해서 발생하는 동작
  - 브라우저가 사용자에게 이벤트를 알려주면 어떤 방식으로든 반응할 수 있습니다.
- 이벤트에 반응하려면 이벤트가 발생한 DOM 요소에 콜백함수를 연결해야 합니다.
  - 뷰나 시스템에 의한 이벤트라면 `window` 객체에 연결해야 합니다.

### 속성에 핸들러 연결

- `on*` prefix를 가지는 속성에 콜백을 메서드로 정의합니다.
  - `onclick`, `onmouseover`, `onblur` 등
  - 모든 이벤트 타입마다 DOM 요소에 해당하는 속성을 가질 수 있습니다.
- DOM 요소에 이벤트를 가장 빠르게 연결할 수 있지만 가장 지저분한 방법이므로 지양해야 합니다.
  - 한번에 하나의 콜백을 지정할 수 있기 때문에 덮어쓸 수 있어서 손실될 위험성이 있습니다.

### `addEventListener`로 핸들러 연결

- 이벤트를 처리할 수 있는 DOM node가 구현하는 `EventTarget` 인터페이스의 `addEventListener` 메스드를 사용합니다.
- 속성 방식과는 다르게 필요한 모든 핸들러들을 계속 등록할 수 있습니다.
- 화면에 DOM node가 더 이상 존재하지 않을 시 메모리 누수를 방지하기 위해 `removeEventListener` 로 이벤트 리스너를 삭제해야 합니다.
  - `removeEventListener`의 인자로 전달하는 콜백함수는 `addEventListener`의 콜백함수와 동일한 참조를 유지해야 합니다(메모리에서 제거 대상이므로).

### 이벤트 객체

- 이벤트 핸들러의 매개변수
- 기본적으로 `Event` 인터페이스를 구현하고 이벤트 타입에 따라 다르게 확장됩니다.
  - 예) [MouseEvent](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent)

### DOM 이벤트 라이프사이클

- [DOM 이벤트 흐름](../../../studies/browser/web-api/event)

### 사용자 정의 이벤트 사용

- DOM API로 사용자 정의 이벤트 타입을 정의하고 기존 이벤트와 동일하게 처리할 수 있습니다.
  - 이벤트와 함께 전달한 페이로드도 정의할 수 있습니다.
- 도메인에 바인딩되고 시스템(웹앱) 자체에서만 발생하는 DOM 이벤트를 생성할 수 있기 때문에 매우 중요한 개념입니다.

## TodoMVC에 이벤트 추가

### 렌더링 엔진 리뷰

- DOM node 생성
  - 문자열로 DOM node를 만들어서 부모 node의 `innerHtml`로 추가하면 이벤트 리스터를 추가할 수 없습니다.
    -  `document.createElement` 메서드로 node를 생성하도록 수정합니다.
      - 다만 코드의 가독성이 떨어질 수 있습니다.
  - [`template` 태그](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template)를 사용하여 내부에 마크업을 유지하고 `clone` 메서드로 내부 contents를 복사하여 재사용합니다.

### 기본 이벤트 처리 아키텍처

- 초기 렌더링 이후, 이벤트가 발생할 때마다 상태를 업데이트하고 메인 렌더링 함수를 호출하여 리렌더링을 수행합니다.
- 컴포넌트 함수의 세 번째 매개변수로 `events` 객체(=이벤트 레지스트리)를 전달합니다.
  - 이벤트 타입별로 상태를 업데이트하고 렌더링 함수를 수동으로 호출하는 메서드가 정의됩니다.

## 이벤트 위임

- 이벤트 버블링을 이용하여 하위 DOM node에서 발생한 이벤트를 상위 DOM node에서 처리하는 기법
  - 프론트엔드 프레임워크에서 대부분 제공하면서 숨겨진 기능
  - 이벤트 핸들러를 등록할 때 [Element.matches API](https://developer.mozilla.org/en-US/docs/Web/API/Element/matches)를 사용하면 실제 이벤트 대상인지 여부를 확인할 수 있습니다.
- 개별 항목에 이벤트 핸들러를 등록하는 대신 하나의 이벤트 핸들러만 등록하면 메모리를 절약하고 이벤트 핸들러를 제거하기 쉽기 때문애 대규모 앱에서 유용합니다.
- 이벤트 위임을 쉽게 구현할 수 있는 라이브러리로 [Gator.js](https://github.com/ccampbell/gator)가 있습니다.
- 물론 YAGNI 원칙에 따라 정말로 필요할 때 이벤트 위임과 같은 최적화를 적용하면 됩니다😁

