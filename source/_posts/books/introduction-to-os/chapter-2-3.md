---
title: 2-3. 컴퓨터 성능 향상 기술
date: 2024-11-26 21:57:40
categories:
  - Books
  - 쉽게 배우는 운영체제
#tags:
---
## 버퍼

### 버퍼의 개념

- 처리 속도에 차이가 있는 두 장치 사이에서 그 차이를 완화하는 역할을 가집니다.
  - 입출력 장치 또는 저장장치로부터 데이터를 일정량의 데이터를 모아서 한꺼번에 메모리로 전송할 수 있습니다.
  - 동영상 스트리밍의 경우 재생 중에 영상이 끊기지 않도록 동영상 데이터의 일정 부분을 버퍼에 넣은 후 실행합니다.

### 스풀(Simultaneous Peripheral Operation On-Line, SPOOL)

- CPU와 입출력 장치가 독립적으로 동작하도록 고안된 소프트웨어적인 버퍼
- 예) 프린터의 스풀러(spooler) - 여러 프로그램들이 요청한 인쇄작업을 순차적으로 처리합니다.

## 캐시

### 캐시의 개념

- 메모리와 CPU 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와서(=prefetch) 임시로 저장하는 버퍼
- CPU는 메모리로 접근하기 전에 캐시를 먼저 확인하여 원하는 데이터가 있는 경우 "cache hit", 그렇지 않은 경우 "cache miss"라고 합니다.
- 단위 시간당 cache hit가 발생하는 비율을 적중률(cache hit ratio)이라고 합니다.
  - 적중률을 높이려면 캐시의 크기를 늘리거나 이론에 기반하여 앞으로 자주 사용될 데이터를 추측하여 prefetch하는 등의 방법이 있습니다.

![캐시의 구조](/images/cache_architecture.png)

### 즉시 쓰기와 지연 쓰기

- 캐시 데이터에 변화가 생길 때마다 메모리에 바로 반영하는 방식을 "즉시 쓰기(write through)", 일정 주기로 누적된 변화들을 반영하는 방식을 "지연 쓰기(write back)"라고 합니다.
- 즉시 쓰기 방식은 메모리에 대한 쓰기 연산을 빈번하게 수행하기 때문에 성능이 느리지만 메모리의 최신 값을 항상 유지하기에 데이터를 소실할 가능성이 적습니다.
- 지연 쓰기 방식은 메모리에 대한 쓰기 연산의 횟수가 상대적으로 적지만 임의의 시점에 메모리와 캐시 데이터 사이의 불일치가 일어날 수도 있습니다.

### L1 캐시와 L2 캐시

- 메모리에서 읽힌 명령어는 수행할 작업을 명시한 부분과 작업 대상인 데이터 부분으로 나뉘는데 명령어와 데이터를 구분하지 않는 "일반 캐시(L2 cache)"에 먼저 저장되고 명령어와 데이터를 구분하는 "특수 캐시(L1 캐시)"에 저장됩니다.
- L1 캐시는 CPU의 레지스터(IR, DR), L2 캐시는 메모리와 직접 연결됩니다.

![레벨별 캐시의 구조](/images/layer_cache.png)

## 저장장치의 계층 구조

- 속도가 빠르고 값이 비싼 저장장치를 CPU와 가깝게 두고 값이 싸고 용량이 큰 저장장치를 반대쪽에 배치하여 가격과 컴퓨터 성능 사이의 타협점을 찾을 수 있도록 도와줍니다.
- 다만 계층들 사이에서 중복된 데이터의 일관성이 계속 유지되도록 신경써야 하는데 분산된 데이터베이스나 CPU를 여러 개 사용하는 병렬 컴퓨터의 분산 메모리 등에서 일관성 문제가 발생할 수 있습니다.

![저장장치의 계층구조](/images/storage_layer.png)

## 인터럽트

### 인터럽트의 개념

#### 폴링(polling)
- CPU가 메모리, 주변장치의 상태를 주기적으로 확인하여 특정 조건을 만족하는 경우에 장치로부터 받은 데이터를 처리하는 방식
- 명령어 해석과 실행이라는 본래 역할 외에 입출력, 읽기/쓰기 연산까지 CPU가 관여해야 하므로 작업 효율이 떨어집니다.

#### 인터럽트(interrupt)
- CPU가 작업을 처리하는 동안 데이터 입출력이 이루어지고 완료되면 입출력 관리자 또는 저장장치 관리자가 CPU로 피드백 신호를 전달하는 방식

### 인터럽트 방식의 동작 과정

#### 인터럽트 벡터(interrupt vector)
- 두 관리자가 CPU로 전달하는 피드백 신호는 주변장치별로 부여된 고유 ID인 인터럽트 번호(interrupt number)와 작업 완료 여부를 배열로 정의한 데이터입니다.
- 동시에 여러 장치에서 작업을 완료한 경우 각각 피드백을 보내는게 아닌 한번에 보내도록 도와줍니다.

![인터럽트 벡터](/images/interrupt.png)

### 직접 메모리 접근(Direct Memory Access, DMA)

- 입출력 관리자가 CPU 대신 메모리에 직접 접근하여 입출력 작업을 수행해야 하는 경우에 부여되는 권한
- 과거에는 폴링 방식을 사용하면서 CPU가 메모리와 주변장치에 대한 모든 권한을 가지고 있었지만 인터럽트 방식의 도입으로 입출력 관리자도 입출력 작업을 담당하면서 직접 접근을 제한하기 위한 수단으로 사용됩니다.

![DMA](/images/dma.png)

### 메모리 매핑 입출력(Memory Mapped I/O, MMIO)

- DMA가 부여된 입출력 관리자에 의해서 메모리에 저장된 데이터가 섞이지 않도록 메모리 공간을 커널, CPU, 입출력 관리자가 사용하는 영역으로 나누는 기법

![MMIO](/images/mmio.png)

### 사이클 훔치기(Cycle Stealing)

- CPU와 입출력 관리자가 동시에 메모리에 접근하려는 경우 CPU가 작업속도가 상대적으로 느린 입출력 관리자에게 메모리 사용권한을 양보하는 상황

