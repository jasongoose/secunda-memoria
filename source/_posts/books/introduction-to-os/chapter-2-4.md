---
title: 2-4. 병렬 처리
date: 2024-11-26 21:58:11
categories:
  - Books
  - 쉽게 배우는 운영체제
#tags:
---
## 병렬 처리의 개념

- 동시에 여러 개의 명령어들을 처리하여 작업의 능률을 올리는 방식
  - 앞으로 나올 **단일 명령어를 단일 어셈블리 코드**라고 생각하면 이해하기 쉽습니다!

## 병렬 처리 시 고려 사항

### 상호 의존성이 없어야 병렬 처리가 가능하다.

- 각 명령어가 서로 독립적이고 앞 단계의 결과가 뒤 단계에 영향을 미쳐서는 안 됩니다.

### 각 단계의 시간을 거의 일정하게 맞춰야 병렬 처리가 원만하게 이루어진다.

- 명령어를 구성하는 개별 단계의 시간이 다르다면 시간이 걸리는 단계에서 병목 현상이 발생하여 전체 작업시간이 늘어납니다.
  - 책에서는 볶음밥을 요리하는 일(=명령어 처리)을 4개의 단계로 나누고 서로 겹치는 않는 단계들을 동시에 처리하는 상황을 가정하고 있습니다.

![병렬 처리 병목 현상](/images/bottle_neck.png)


### 전체 작업 시간을 몇 단계로 나눌지 잘 따져보아야 한다.

- 동시에 처리할 수 있는 단계들의 개수인 N을 "병렬 처리의 깊이(depth of parallel processing)"이라고 합니다.
- 깊이가 클수록 성능이 올라가지만 너무 깊으면 단계마다 작업을 이동하고 새로운 작업을 불러오는데 시간이 많아지지면서 오히려 성능이 떨어지는 오버헤드의 원인이 될 수 있습니다.
- 그래서 보통 깊이는 10 이상 20 이하로 잡습니다.

![병렬 처리 깊이](/images/bottle_neck_depth.png)


## 병렬 처리 기법

### 스레드

- CPU에서 단일 명령어를 처리하는 과정(이자 명령어를 처리하는 주체)
- 스레드를 구성하는 각 단계는 CPU의 클록과 연동되어 **1 tick에 하나의 단계가 실행됩니다.**

#### 1. 명령어 패치(Instruction Fetch, IF)
- 다음에 실행할 명령어를 IR에 저장합니다.

#### 2. 명령어 해석(Instruction Decode, ID)
- 명령어를 해석합니다.

#### 3. 실행(Execution, EX)
- 해석한 결과를 토대로 명령어를 실행합니다.

#### 4. 쓰기(Write Back, WB)
- 실행된 결과를 메모리에 저장합니다.

### 파이프라인 기법

- CPU의 사용을 극대화하기 위해 명령어들을 겹쳐서 실행하는 방법으로, 하나의 코어에서 여러 개의 스레드들을 사용합니다.
- **명령어를 구성하는 개별 단계를 동시에 처리하도록 하드웨어를 독립적으로 구성합니다.**
- 명령어 처리를 N개의 단계로 나눈다면 동시에 처리되는 명령어의 개수가 최대 N개가 됩니다.

![파이프라인 기법](/images/pipeline.png)

#### 파이프라인의 위험

- 데이터 위험
  - 동시에 처리하려는 두 명령어 사이에서 데이터 의존성이 생기는 경우입니다.
  - 파이프라인의 명령어 단계를 지연하여 해결할 수 있습니다.
- 제어 위험
  - `if` 문이나 `goto` 문에 의해서 PC 값을 갑자기 변하면서 발생합니다.
  - 분기 예측이나 분기 지연과 같은 방법으로 해결할 수 있습니다.
- 구조 위험
  - 서로 다른 명령어가 같은 자원에 접근하려는 경우 발생합니다.

### 슈퍼스칼라 기법

- 파이프라인을 처리할 수 있는 코어를 여러 개로 구성하여 복수의 명령어들을 동시에 실행되도록 하는 방식입니다.
- 파이프라인 기법과 마찬가지로 명령어들 사이의 상호 의존성이 없어야 하고 이를 위한 처리도 컴파일러에서 이루어지도록 조정해야 합니다.

![슈퍼스칼라 기법](/images/super_scala.png)


### 슈퍼파이프라인 기법

- 기존 파이프라인 기법에서 1 tick에 하나의 단계를 실행한 것과는 달리 1 tick 내에서 여러 단계들을 동시에 처리할 수 있습니다.
- 아래 이미지를 보면 두번째 스레드의 ID를 처리하면서 동시에 첫번째 스레드의 ID와 EX, 세번째 스레드의 IF, ID, 네번째 스레드의 IF를 처리하고 있습니다.

![슈퍼파이프라인 기법](/images/super_pipeline.png)

### 슈퍼파이프라인 슈퍼스칼라 기법

- 슈퍼파이프라인을 처리할 수 있는 코어를 여러 개로 구성하여 동시에 처리합니다.

![슈퍼파이프라인 슈퍼스칼라 기법](/images/super_pipeline_super_scala.png)

### VLIW 기법

- CPU가 하드웨어적으로 병렬 처리를 지원하지 않는 경우 동시에 수행할 명령어들을 컴파일러로 추출하고 하나의 명령어로 압축하여 실행합니다.
- 동시에 처리하는 명령어들의 개수가 상대적으로 적고 컴파일을 통해 소프트웨어적으로 병렬 처리를 한다는 점에서 차이가 있습니다.