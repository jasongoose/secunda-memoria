---
title: 2-2. CPU와 메모리
date: 2024-11-26 21:57:37
categories:
  - Books
  - 쉽게 배우는 운영체제
#tags:
---
## CPU의 구성과 동작

### CPU의 기본 구성

- 산술논리 연산장치(Arithmetic and Logic Unit, ALU)
  - 데이터를 대상으로 사칙연산과 논리연산을 수행하는 장치
- 제어장치(Control Unit, CU)
  - 명령어를 해석하여 제어 신호를 보내고 CPU 내의 데이터 흐름을 조절하는 장치
- 레지스터(register)
  - 연산 전후로 데이터를 임시로 보관하는 장소

### CPU의 명령어 처리 과정

아래 c언어로 작성된 코드는

```c
int D2 = 2, D3 = 3, sum;
sum = D2 + D3;
```

아래와 같은 어셈블리어로 작성할 수 있습니다.

```text
LOAD mem(100), register 2; ---- (1)
LOAD mem(120), register 3; ---- (2)
ADD register 5, register 2, register 3; ---- (3)
MOVE register 5, mem(160); ---- (4)
```

여기서 `LOAD`, `ADD`, `MOVE`와 같은 연산은 아래 이미지와 같이 CU의 지시에 의해서 시작됩니다.

![CPU의 명령어 처리 과정](/images/cpu_architecture.png)

### 레지스터의 종류

#### 사용자 가시 레지스터

- 데이터 레지스터(DR)
  - 메모리에서 가져온 데이터를 임시로 보관할 때 사용하는 레지스터
  - CPU 내의 레지스터 대부분이 DR이기 때문에 "범용 레지스터" 또는 "일반 레지스터"라고도 불립니다.
- 주소 레지스터(AR)
  - 데이터 또는 명령어가 저장된 메모리의 주소를 가지는 레지스터

#### 사용자 비가시 레지스터(=특수 레지스터)

- 프로그램 카운터(PC)
  - 다음에 처리할 명령어가 저장된 메모리의 주소를 저장하는 레지스터
- 명령어 레지스터(IR)
  - 현재 실행 중인 명령어를 저장하는 레지스터
- 메모리 주소 레지스터(MAR)
  - 메모리에서 데이터를 가져오거나 메모리로 데이터를 보낼 메모리 주소를 지정하는 레지스터
- 메모리 버퍼 레지스터(MBR)
  - 메모리에서 가져온 데이터나 메모리로 옮겨 갈 데이터를 임시로 저장하는 레지스터
  - MAR과 함께 동작합니다.
- 프로그램 상태 레지스터(PSR)
  - 연산 결과(양수, 음수 등)을 저장합니다.

위에 있던 어셈블리어 예시에서 `LOAD mem(100), register 2;` 코드를 처리하는 과정에서 특수 레지스터는 아래와 같이 사용됩니다.

1. PC에 실행할 명령어의 주소가 저장된 상태이고 이 주소값은 CU로 전송됩니다.
2. IR에는 `LOAD` 명령어가 저장됩니다.
3. CU가 IR에 저장된 명령어를 해석하여 메모리에서 데이터를 가져오라는 제어신호를 보냅니다.
4. MAR에 "100"이 저장되고 해당 주소에 저장된 데이터가 MBR에 저장됩니다.
5. CU는 MBR에 저장된 값을 "register 2"로 옮깁니다.

![특수 레지스터 명령어 수행과정](/images/cpu_register.png)

### 시스템 버스의 종류

#### 제어 버스

- CPU의 CU를 메모리, 주변장치와 연결하는 버스
- 메모리 또는 저장장치에 대한 읽기/쓰기, 주변장치의 입출력 결과 피드백, 메모리 오류 등에 관련된 신호를 양방향으로 주고받습니다.

#### 주소 버스

- CPU의 MAR을 메모리, 주변장치와 연결하는 버스
- 메모리 또는 저장장치에 대해 읽기/쓰기를 적용할 주소를 단방향(MAR -> 메모리, 저장장치)으로 전달합니다.

#### 데이터 버스

- CPU의 MBR을 메모리, 주변장치와 연결하는 버스
- 데이터 이동이 양방향으로 이루어집니다.

### 대역폭

- 버스를 통해 한번에 전달할 수 있는 데이터의 최대 크기(=word)
  - CPU가 한번에 처리하는 데이터의 최대 크기
  - CPU 레지스터의 크기
  - 메모리에 한번에 저장할 수 있는 데이터의 최대 크기

![버스의 종류](/images/system_bus.png)

## 메모리의 종류와 부팅

### 메모리의 종류

#### RAM(Random Access Memory)

- 무작위로 데이터를 읽어도 저장된 위치와 상관없이 같은 속도로 데이터를 읽을 수 있습니다.
- DRAM(Dynamic RAM)
  - O과 1의 데이터가 일정 시간이 지나면 사라지므로 일정 시간마다 다시 재생시켜야 합니다.
  - 메인메모리에 사용됩니다.
- SRAM(Static RAM)
  - 전력이 공급되는 동안에는 데이터를 보관할 수 있어서 재생할 필요가 없습니다.
  - DRAM보다 속도가 빠르지만 가격이 비싸기 때문에 캐시 같은 고속 메모리에 사용됩니다.
- SDRAM(Synchronous DRAM)
  - tick(pulse)이 발생할 때마다 데이터를 저장합니다.

#### ROM(Read Only Memory)

- 전력이 끊겨도 데이터가 없어지지 않지만 읽기만 가능합니다.
- mask ROM
  - 데이터를 읽거나 쓸 수 없습니다.
- PROM(Programmable ROM)
  - 전용기계를 사용하여 데이터를 한번만 저장할 수 있습니다.
- EPROM(Erasable Programmable ROM)
  - 데이터를 여러 번 쓰고 지울 수 있습니다.

![메모리의 종류](/images/ram_rom.png)

### 메모리 보호

- 사용자 작업이 CPU를 사용하는 동안에 메모리 내 운영체제나 다른 작업 영역을 침범하지 않도록 작업의 메모리 시작 주소를 경계 레지스터(bound register), 작업의 마지막 주소까지의 차이를 한계 레지스터(limit register)에 저장합니다.
- 만일 작업 중 두 레지스터로 지정된 주소 범위를 벗어난 경우 인터럽트가 발생하여 운영체제가 해당 작업을 강제로 중단합니다.

![메모리 보호](/images/memory_protection.webp)

### 부팅

- 컴퓨터를 켰을 때 운영체제를 메모리에 올리는 과정

#### 순서

1. 컴퓨터를 키면 ROM에 저장된 BIOS가 실행되어 하드웨어 상태를 점검합니다.
2. 이상이 없으면 하드디스크의 첫번째 sector인 마스터 부트 레코드(Master Boot Record, MBT)에 위치한 부트스트랩(bootstrap)을 실행합니다.
3. bootstrap의 실행으로 운영체제 프로그램이 메모리에 load됩니다.

![부팅](/images/booting.png)
